<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>[GenAI Placeholder] Anomaly Detection | Analytics &amp; Modeling Blog</title>
<meta name="keywords" content="anomaly detection, machine learning, DevOps, Python, D3.js, GenAI, Placeholder">
<meta name="description" content="Note: this post was created by GenAI (Claude) for temporary filler content.
The 3 AM Wake-up Call It was 3 AM when my phone buzzed with an urgent alert: our main API endpoint was experiencing unusual latency spikes. But here&rsquo;s the twist - our newly implemented anomaly detection system caught this before any user reported issues. By the time I checked the dashboard, our automated remediation had already scaled up the necessary resources.">
<meta name="author" content="Trevor Jordan">
<link rel="canonical" href="/blog/posts/20240103-anomaly-detection/">
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="/blog/apple-touch-icon.png">
<link rel="mask-icon" href="/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="/blog/posts/20240103-anomaly-detection/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:url" content="/blog/posts/20240103-anomaly-detection/">
  <meta property="og:site_name" content="Analytics &amp; Modeling Blog">
  <meta property="og:title" content="[GenAI Placeholder] Anomaly Detection">
  <meta property="og:description" content="Note: this post was created by GenAI (Claude) for temporary filler content.
The 3 AM Wake-up Call It was 3 AM when my phone buzzed with an urgent alert: our main API endpoint was experiencing unusual latency spikes. But here’s the twist - our newly implemented anomaly detection system caught this before any user reported issues. By the time I checked the dashboard, our automated remediation had already scaled up the necessary resources.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-03T00:00:00+00:00">
    <meta property="article:tag" content="Anomaly Detection">
    <meta property="article:tag" content="Machine Learning">
    <meta property="article:tag" content="DevOps">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="D3.js">
    <meta property="article:tag" content="GenAI">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[GenAI Placeholder] Anomaly Detection">
<meta name="twitter:description" content="Note: this post was created by GenAI (Claude) for temporary filler content.
The 3 AM Wake-up Call It was 3 AM when my phone buzzed with an urgent alert: our main API endpoint was experiencing unusual latency spikes. But here&rsquo;s the twist - our newly implemented anomaly detection system caught this before any user reported issues. By the time I checked the dashboard, our automated remediation had already scaled up the necessary resources.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "[GenAI Placeholder] Anomaly Detection",
      "item": "/blog/posts/20240103-anomaly-detection/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[GenAI Placeholder] Anomaly Detection",
  "name": "[GenAI Placeholder] Anomaly Detection",
  "description": "Note: this post was created by GenAI (Claude) for temporary filler content.\nThe 3 AM Wake-up Call It was 3 AM when my phone buzzed with an urgent alert: our main API endpoint was experiencing unusual latency spikes. But here\u0026rsquo;s the twist - our newly implemented anomaly detection system caught this before any user reported issues. By the time I checked the dashboard, our automated remediation had already scaled up the necessary resources.",
  "keywords": [
    "anomaly detection", "machine learning", "DevOps", "Python", "D3.js", "GenAI", "Placeholder"
  ],
  "articleBody": "Note: this post was created by GenAI (Claude) for temporary filler content.\nThe 3 AM Wake-up Call It was 3 AM when my phone buzzed with an urgent alert: our main API endpoint was experiencing unusual latency spikes. But here’s the twist - our newly implemented anomaly detection system caught this before any user reported issues. By the time I checked the dashboard, our automated remediation had already scaled up the necessary resources.\nWhy Traditional Monitoring Falls Short Traditional monitoring relies heavily on static thresholds. Set them too low, and you’re drowning in false alarms. Set them too high, and you miss critical issues. The reality is that “normal” behavior changes based on time of day, day of week, and numerous other factors.\nBuilding a Dynamic Solution Let’s walk through how we built our anomaly detection system using Python. We’ll use a combination of statistical methods and machine learning to create a robust solution.\nimport numpy as np import pandas as pd from sklearn.preprocessing import StandardScaler from sklearn.ensemble import IsolationForest from datetime import datetime, timedelta import json # Load and prepare the data def prepare_data(df): # Convert timestamp to datetime df['timestamp'] = pd.to_datetime(df['timestamp']) # Add time-based features df['hour'] = df['timestamp'].dt.hour df['day_of_week'] = df['timestamp'].dt.dayofweek df['is_weekend'] = df['day_of_week'].isin([5, 6]).astype(int) return df # Feature engineering for API metrics def engineer_features(df): # Calculate rolling statistics windows = [5, 15, 30] # minutes for window in windows: df[f'latency_rolling_mean_{window}m'] = df['latency'].rolling( window=window).mean() df[f'latency_rolling_std_{window}m'] = df['latency'].rolling( window=window).std() df[f'requests_rolling_sum_{window}m'] = df['request_count'].rolling( window=window).sum() return df # Anomaly detection model class RealTimeAnomalyDetector: def __init__(self, contamination=0.01): self.scaler = StandardScaler() self.model = IsolationForest( contamination=contamination, random_state=42, n_jobs=-1 ) self.feature_columns = None def fit(self, df): feature_data = self._prepare_features(df) self.scaler.fit(feature_data) scaled_data = self.scaler.transform(feature_data) self.model.fit(scaled_data) def predict(self, df): feature_data = self._prepare_features(df) scaled_data = self.scaler.transform(feature_data) predictions = self.model.predict(scaled_data) # Convert to anomaly probabilities scores = self.model.score_samples(scaled_data) return predictions, scores def _prepare_features(self, df): features = [ 'latency', 'request_count', 'error_rate', 'latency_rolling_mean_5m', 'latency_rolling_std_5m', 'requests_rolling_sum_5m' ] if self.feature_columns is None: self.feature_columns = features return df[self.feature_columns] Interactive Visualization Below is an interactive visualization of our API metrics with detected anomalies highlighted. The system adapts to changing patterns while maintaining high accuracy.\nModel Training and Evaluation Here’s how we trained and evaluated our model:\n# Train the model on historical data detector = RealTimeAnomalyDetector(contamination=0.01) detector.fit(training_data) # Evaluate on test set predictions, scores = detector.predict(test_data) # Calculate metrics from sklearn.metrics import precision_recall_fscore_support # Assuming we have some labeled anomalies for validation precision, recall, f1, _ = precision_recall_fscore_support( true_labels, predictions, average='binary' ) print(f\"Precision: {precision:.3f}\") print(f\"Recall: {recall:.3f}\") print(f\"F1 Score: {f1:.3f}\") Real-world Results After deploying this system, we saw significant improvements:\nFaster Detection: Average time to detect issues decreased from 15 minutes to 45 seconds Fewer False Alarms: False positive rate dropped by 76% Cost Savings: Prevented two potential outages in the first month Team Impact: Reduced after-hours calls by 63% Deployment Architecture Here’s how we integrated the anomaly detection system into our infrastructure:\ndef process_metrics_stream(metrics_stream): \"\"\"Process incoming metrics in real-time\"\"\" # Create a buffer for streaming data buffer = pd.DataFrame() for metric in metrics_stream: # Add new metric to buffer buffer = buffer.append(metric, ignore_index=True) # Keep last 24 hours of data buffer = buffer[ buffer['timestamp'] \u003e datetime.now() - timedelta(hours=24) ] # Prepare features prepared_data = prepare_data(buffer.copy()) engineered_data = engineer_features(prepared_data) # Detect anomalies predictions, scores = detector.predict(engineered_data) # If anomaly detected, trigger alert if predictions[-1] == -1: trigger_alert(metric, scores[-1]) Future Improvements We’re currently working on several enhancements:\nSeasonal Adjustment: Adding explicit seasonal decomposition Multi-dimensional Analysis: Incorporating dependencies between different services Automated Recovery: Expanding automated remediation capabilities Transfer Learning: Pre-training models on similar services Technical Deep Dive For those interested in the implementation details, here are some key considerations:\nFeature Engineering\nRolling statistics capture short-term trends Time-based features handle seasonality Service-specific metrics provide context Model Selection\nIsolation Forest handles high-dimensional data well Unsupervised approach adapts to changing patterns Low computational overhead for real-time processing Production Architecture\nStreaming pipeline using Apache Kafka Model serving with Redis-backed caching Automated retraining pipeline Code and Data Availability The complete implementation, including the data preparation pipeline and deployment scripts, is available in our GitHub repository.\nReferences Liu, Fei Tony, Kai Ming Ting, and Zhi-Hua Zhou. “Isolation forest.” 2008 Eighth IEEE International Conference on Data Mining. Chandola, Varun, Arindam Banerjee, and Vipin Kumar. “Anomaly detection: A survey.” ACM computing surveys (CSUR). Laptev, Nikolay, Saeed Amizadeh, and Ian Flint. “Generic and scalable framework for automated time-series anomaly detection.” KDD 2015. This post was written by GenAI (Claude), a data scientist specializing in real-time analytics and machine learning systems.\n",
  "wordCount" : "743",
  "inLanguage": "en",
  "datePublished": "2024-01-03T00:00:00Z",
  "dateModified": "2024-01-03T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Trevor Jordan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/blog/posts/20240103-anomaly-detection/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Analytics \u0026 Modeling Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/blog/" accesskey="h" title="Analytics &amp; Modeling Blog (Alt + H)">Analytics &amp; Modeling Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/blog/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="/blog/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="/blog/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="/blog/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://tsj7ww.github.io/personal" title="Portfolio">
                    <span>Portfolio</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="/blog/">Home</a>&nbsp;»&nbsp;<a href="/blog/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      [GenAI Placeholder] Anomaly Detection
    </h1>
    <div class="post-meta"><span title='2024-01-03 00:00:00 +0000 UTC'>January 3, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Trevor Jordan

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#the-3-am-wake-up-call" aria-label="The 3 AM Wake-up Call">The 3 AM Wake-up Call</a></li>
                <li>
                    <a href="#why-traditional-monitoring-falls-short" aria-label="Why Traditional Monitoring Falls Short">Why Traditional Monitoring Falls Short</a></li>
                <li>
                    <a href="#building-a-dynamic-solution" aria-label="Building a Dynamic Solution">Building a Dynamic Solution</a></li>
                <li>
                    <a href="#interactive-visualization" aria-label="Interactive Visualization">Interactive Visualization</a></li>
                <li>
                    <a href="#model-training-and-evaluation" aria-label="Model Training and Evaluation">Model Training and Evaluation</a></li>
                <li>
                    <a href="#real-world-results" aria-label="Real-world Results">Real-world Results</a></li>
                <li>
                    <a href="#deployment-architecture" aria-label="Deployment Architecture">Deployment Architecture</a></li>
                <li>
                    <a href="#future-improvements" aria-label="Future Improvements">Future Improvements</a></li>
                <li>
                    <a href="#technical-deep-dive" aria-label="Technical Deep Dive">Technical Deep Dive</a></li>
                <li>
                    <a href="#code-and-data-availability" aria-label="Code and Data Availability">Code and Data Availability</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Note: this post was created by GenAI (Claude) for temporary filler content.</p>
<h2 id="the-3-am-wake-up-call">The 3 AM Wake-up Call<a hidden class="anchor" aria-hidden="true" href="#the-3-am-wake-up-call">#</a></h2>
<p>It was 3 AM when my phone buzzed with an urgent alert: our main API endpoint was experiencing unusual latency spikes. But here&rsquo;s the twist - our newly implemented anomaly detection system caught this before any user reported issues. By the time I checked the dashboard, our automated remediation had already scaled up the necessary resources.</p>
<h2 id="why-traditional-monitoring-falls-short">Why Traditional Monitoring Falls Short<a hidden class="anchor" aria-hidden="true" href="#why-traditional-monitoring-falls-short">#</a></h2>
<p>Traditional monitoring relies heavily on static thresholds. Set them too low, and you&rsquo;re drowning in false alarms. Set them too high, and you miss critical issues. The reality is that &ldquo;normal&rdquo; behavior changes based on time of day, day of week, and numerous other factors.</p>
<h2 id="building-a-dynamic-solution">Building a Dynamic Solution<a hidden class="anchor" aria-hidden="true" href="#building-a-dynamic-solution">#</a></h2>
<p>Let&rsquo;s walk through how we built our anomaly detection system using Python. We&rsquo;ll use a combination of statistical methods and machine learning to create a robust solution.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load and prepare the data</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert timestamp to datetime</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Add time-based features</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_weekend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Feature engineering for API metrics</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">engineer_features</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate rolling statistics</span>
</span></span><span class="line"><span class="cl">    <span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>  <span class="c1"># minutes</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;latency_rolling_mean_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;latency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;latency_rolling_std_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;latency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;requests_rolling_sum_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Anomaly detection model</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealTimeAnomalyDetector</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">contamination</span><span class="o">=</span><span class="n">contamination</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">feature_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">scaled_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feature_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">feature_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">scaled_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feature_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Convert to anomaly probabilities</span>
</span></span><span class="line"><span class="cl">        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">scores</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_prepare_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;latency&#39;</span><span class="p">,</span> <span class="s1">&#39;request_count&#39;</span><span class="p">,</span> <span class="s1">&#39;error_rate&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;latency_rolling_mean_5m&#39;</span><span class="p">,</span> <span class="s1">&#39;latency_rolling_std_5m&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;requests_rolling_sum_5m&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="n">features</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">]</span>
</span></span></code></pre></div><h2 id="interactive-visualization">Interactive Visualization<a hidden class="anchor" aria-hidden="true" href="#interactive-visualization">#</a></h2>
<p>Below is an interactive visualization of our API metrics with detected anomalies highlighted. The system adapts to changing patterns while maintaining high accuracy.</p>
<div id="anomaly-viz"></div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="/blog/js/anomaly.js"></script>
<style>
#anomaly-viz {
    width: 100%;
    min-height: 500px;
    /* margin: 20px 0; */
    background:rgba(26, 26, 26, 0);
    border-radius: 8px;
    padding: 20px;
}
#anomaly-viz svg {
    width: 100%;
    height: 100%;
    overflow: visible;
}
</style>
<h2 id="model-training-and-evaluation">Model Training and Evaluation<a hidden class="anchor" aria-hidden="true" href="#model-training-and-evaluation">#</a></h2>
<p>Here&rsquo;s how we trained and evaluated our model:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Train the model on historical data</span>
</span></span><span class="line"><span class="cl"><span class="n">detector</span> <span class="o">=</span> <span class="n">RealTimeAnomalyDetector</span><span class="p">(</span><span class="n">contamination</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">detector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Evaluate on test set</span>
</span></span><span class="line"><span class="cl"><span class="n">predictions</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Calculate metrics</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Assuming we have some labeled anomalies for validation</span>
</span></span><span class="line"><span class="cl"><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_fscore_support</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">true_labels</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">predictions</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">average</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Recall: </span><span class="si">{</span><span class="n">recall</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="real-world-results">Real-world Results<a hidden class="anchor" aria-hidden="true" href="#real-world-results">#</a></h2>
<p>After deploying this system, we saw significant improvements:</p>
<ol>
<li><strong>Faster Detection</strong>: Average time to detect issues decreased from 15 minutes to 45 seconds</li>
<li><strong>Fewer False Alarms</strong>: False positive rate dropped by 76%</li>
<li><strong>Cost Savings</strong>: Prevented two potential outages in the first month</li>
<li><strong>Team Impact</strong>: Reduced after-hours calls by 63%</li>
</ol>
<h2 id="deployment-architecture">Deployment Architecture<a hidden class="anchor" aria-hidden="true" href="#deployment-architecture">#</a></h2>
<p>Here&rsquo;s how we integrated the anomaly detection system into our infrastructure:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">process_metrics_stream</span><span class="p">(</span><span class="n">metrics_stream</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Process incoming metrics in real-time&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a buffer for streaming data</span>
</span></span><span class="line"><span class="cl">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_stream</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Add new metric to buffer</span>
</span></span><span class="line"><span class="cl">        <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Keep last 24 hours of data</span>
</span></span><span class="line"><span class="cl">        <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">buffer</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">            <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Prepare features</span>
</span></span><span class="line"><span class="cl">        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">prepare_data</span><span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">engineered_data</span> <span class="o">=</span> <span class="n">engineer_features</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Detect anomalies</span>
</span></span><span class="line"><span class="cl">        <span class="n">predictions</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">engineered_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># If anomaly detected, trigger alert</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">predictions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">trigger_alert</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span></code></pre></div><h2 id="future-improvements">Future Improvements<a hidden class="anchor" aria-hidden="true" href="#future-improvements">#</a></h2>
<p>We&rsquo;re currently working on several enhancements:</p>
<ol>
<li><strong>Seasonal Adjustment</strong>: Adding explicit seasonal decomposition</li>
<li><strong>Multi-dimensional Analysis</strong>: Incorporating dependencies between different services</li>
<li><strong>Automated Recovery</strong>: Expanding automated remediation capabilities</li>
<li><strong>Transfer Learning</strong>: Pre-training models on similar services</li>
</ol>
<h2 id="technical-deep-dive">Technical Deep Dive<a hidden class="anchor" aria-hidden="true" href="#technical-deep-dive">#</a></h2>
<p>For those interested in the implementation details, here are some key considerations:</p>
<ol>
<li>
<p><strong>Feature Engineering</strong></p>
<ul>
<li>Rolling statistics capture short-term trends</li>
<li>Time-based features handle seasonality</li>
<li>Service-specific metrics provide context</li>
</ul>
</li>
<li>
<p><strong>Model Selection</strong></p>
<ul>
<li>Isolation Forest handles high-dimensional data well</li>
<li>Unsupervised approach adapts to changing patterns</li>
<li>Low computational overhead for real-time processing</li>
</ul>
</li>
<li>
<p><strong>Production Architecture</strong></p>
<ul>
<li>Streaming pipeline using Apache Kafka</li>
<li>Model serving with Redis-backed caching</li>
<li>Automated retraining pipeline</li>
</ul>
</li>
</ol>
<h2 id="code-and-data-availability">Code and Data Availability<a hidden class="anchor" aria-hidden="true" href="#code-and-data-availability">#</a></h2>
<p>The complete implementation, including the data preparation pipeline and deployment scripts, is available in our <a href="https://github.com/tsj7ww">GitHub repository</a>.</p>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ol>
<li>Liu, Fei Tony, Kai Ming Ting, and Zhi-Hua Zhou. &ldquo;Isolation forest.&rdquo; 2008 Eighth IEEE International Conference on Data Mining.</li>
<li>Chandola, Varun, Arindam Banerjee, and Vipin Kumar. &ldquo;Anomaly detection: A survey.&rdquo; ACM computing surveys (CSUR).</li>
<li>Laptev, Nikolay, Saeed Amizadeh, and Ian Flint. &ldquo;Generic and scalable framework for automated time-series anomaly detection.&rdquo; KDD 2015.</li>
</ol>
<hr>
<p><em>This post was written by GenAI (Claude), a data scientist specializing in real-time analytics and machine learning systems.</em></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/blog/tags/anomaly-detection/">Anomaly Detection</a></li>
      <li><a href="/blog/tags/machine-learning/">Machine Learning</a></li>
      <li><a href="/blog/tags/devops/">DevOps</a></li>
      <li><a href="/blog/tags/python/">Python</a></li>
      <li><a href="/blog/tags/d3.js/">D3.js</a></li>
      <li><a href="/blog/tags/genai/">GenAI</a></li>
      <li><a href="/blog/tags/placeholder/">Placeholder</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="/blog/posts/package-development/">
    <span class="title">« Prev</span>
    <br>
    <span>Software Development: Python Packages</span>
  </a>
  <a class="next" href="/blog/posts/20240102-feature-engineering/">
    <span class="title">Next »</span>
    <br>
    <span>[GenAI Placeholder] Feature Engineering</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© 2025 Trevor Jordan</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
